<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Solicitud de Vacaciones - Biotecnologías RLD</title>
  <style>
    body{font-family: Arial, sans-serif; padding:20px; max-width:900px; margin:auto; color:#111}
    h1{font-size:20px; margin-bottom:5px; text-align:center}
    label{display:block; margin-top:10px; font-weight:600}
    input[type="text"], input[type="date"], textarea {
      width:100%; padding:8px; box-sizing:border-box; margin-top:5px
    }
    .row{display:flex; gap:10px}
    .col{flex:1}
    button{margin-top:12px; padding:10px 14px; cursor:pointer}
    .small{font-size:13px; color:#444}
    .note{background:#f7f7f7; padding:10px; border-left:4px solid #2196F3; margin-top:12px}
  </style>
</head>
<body>
  <h1>Solicitud de Vacaciones</h1>
  <p class="small">Complete el formulario y escriba su nombre en el campo de firma.</p>

  <form id="vacForm">
    <label>Nombre del colaborador(a):
      <input type="text" id="nombre" required />
    </label>

    <label>Área / Puesto:
      <input type="text" id="area" />
    </label>

    <label>Fecha de ingreso:
      <input type="date" id="fecha_ingreso" />
    </label>

    <div class="row">
      <div class="col">
        <label>Inicio de vacaciones:
          <input type="date" id="fecha_inicio" />
        </label>
      </div>
      <div class="col">
        <label>Fin de vacaciones:
          <input type="date" id="fecha_fin" />
        </label>
      </div>
    </div>

    <label>Total de días hábiles solicitados:
      <input type="text" id="total_dias" />
    </label>

    <label>Comentarios / Observaciones:
      <textarea id="comentarios" rows="3"></textarea>
    </label>

    <div class="row" style="margin-top:12px;">
      <div class="col">
        <label>Firma del colaborador(a) (nombre completo):</label>
        <input type="text" id="firma_colaborador" />
      </div>
      <div class="col">
        <label>Firma COO (nombre completo):</label>
        <input type="text" id="firma_rrhh" />
      </div>
    </div>

    <div class="note">
      <strong>Instrucciones:</strong> Escriba su nombre en el campo de firma. Al descargar el PDF, aparecerá como su firma en el documento.
    </div>

    <div style="display:flex; gap:10px; margin-top:12px;">
      <button type="button" id="downloadPdf">Descargar PDF</button>
      <button type="button" id="saveJson">Guardar datos (JSON)</button>
      <button type="reset" id="resetBtn">Limpiar formulario</button>
    </div>
  </form>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    document.getElementById('downloadPdf').addEventListener('click', async function(){
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ unit: 'pt', format: 'a4' });

      const html = `
        <h2>Solicitud de Vacaciones</h2>
        <p><strong>Nombre:</strong> ${document.getElementById('nombre').value || ''}</p>
        <p><strong>Área / Puesto:</strong> ${document.getElementById('area').value || ''}</p>
        <p><strong>Fecha de ingreso:</strong> ${document.getElementById('fecha_ingreso').value || ''}</p>
        <p><strong>Periodo solicitado:</strong> ${document.getElementById('fecha_inicio').value || ''} al ${document.getElementById('fecha_fin').value || ''}</p>
        <p><strong>Total días:</strong> ${document.getElementById('total_dias').value || ''}</p>
        <p><strong>Comentarios:</strong> ${document.getElementById('comentarios').value || ''}</p>
        <div style="display:flex; gap:40px; margin-top:40px;">
          <div style="flex:1; text-align:center;">
            <p>Firma del colaborador(a):</p>
            <p style="border-top:1px solid #000; padding-top:5px;">${document.getElementById('firma_colaborador').value || ''}</p>
          </div>
          <div style="flex:1; text-align:center;">
            <p>Firma COO:</p>
            <p style="border-top:1px solid #000; padding-top:5px;">${document.getElementById('firma_rrhh').value || ''}</p>
          </div>
        </div>
      `;

      const wrapper = document.createElement('div');
      wrapper.style.padding = '20px';
      wrapper.innerHTML = html;
      document.body.appendChild(wrapper);

      const canvas = await html2canvas(wrapper, {scale:2});
      const imgData = canvas.toDataURL('image/png');
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

      pdf.addImage(imgData, 'PNG', 20, 20, pdfWidth-40, pdfHeight);
      pdf.save('Solicitud_Vacaciones.pdf');
      document.body.removeChild(wrapper);
    });

    document.getElementById('saveJson').addEventListener('click', function(){
      const data = {
        nombre: document.getElementById('nombre').value,
        area: document.getElementById('area').value,
        fecha_ingreso: document.getElementById('fecha_ingreso').value,
        fecha_inicio: document.getElementById('fecha_inicio').value,
        fecha_fin: document.getElementById('fecha_fin').value,
        total_dias: document.getElementById('total_dias').value,
        comentarios: document.getElementById('comentarios').value,
        firma_colaborador: document.getElementById('firma_colaborador').value,
        firma_rrhh: document.getElementById('firma_rrhh').value,
        generado_en: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Solicitud_Vacaciones.json';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
