<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Solicitud de Vacaciones - Biotecnologías RLD</title>
  <style>
    body{font-family: Arial, sans-serif; padding:20px; max-width:900px; margin:auto; color:#111}
    h1{font-size:20px; margin-bottom:5px}
    label{display:block; margin-top:10px; font-weight:600}
    input[type="text"], input[type="date"], textarea {width:100%; padding:8px; box-sizing:border-box; margin-top:5px}
    .row{display:flex; gap:10px}
    .col{flex:1}
    .signature-box{border:1px solid #999; height:120px; position:relative; margin-top:8px}
    .sig-canvas{width:100%; height:100%}
    button{margin-top:12px; padding:10px 14px; cursor:pointer}
    .small{font-size:13px; color:#444}
    .note{background:#f7f7f7; padding:10px; border-left:4px solid #2196F3; margin-top:12px}
  </style>
</head>
<body>
  <h1 style="text-align: center;">Solicitud de Vacaciones</h1>
  <p class="small">Complete el formulario y firme digitalmente.</p>

  <form id="vacForm">
    <label>Nombre del colaborador(a):
      <input type="text" id="nombre" required />
    </label>

    <label>Área / Puesto:
      <input type="text" id="area" />
    </label>

    <label>Fecha de ingreso:
      <input type="date" id="fecha_ingreso" />
    </label>

    <div class="row">
      <div class="col">
        <label>Inicio de vacaciones:
          <input type="date" id="fecha_inicio" />
        </label>
      </div>
      <div class="col">
        <label>Fin de vacaciones:
          <input type="date" id="fecha_fin" />
        </label>
      </div>
    </div>

    <label>Total de días hábiles solicitados:
      <input type="text" id="total_dias" />
    </label>

    <label>Comentarios / Observaciones:
      <textarea id="comentarios" rows="3"></textarea>
    </label>

    <div style="display:flex; gap:20px; margin-top:12px;">
      <div style="flex:1">
        <label>Firma del colaborador(a):</label>
        <div class="signature-box">
          <canvas id="sig1" class="sig-canvas"></canvas>
        </div>
        <div style="margin-top:6px;">
          <button type="button" onclick="clearSig('sig1')">Borrar firma</button>
        </div>
      </div>

      <div style="flex:1">
        <label>Firma Responsable / Recursos Humanos:</label>
        <div class="signature-box">
          <canvas id="sig2" class="sig-canvas"></canvas>
        </div>
        <div style="margin-top:6px;">
          <button type="button" onclick="clearSig('sig2')">Borrar firma</button>
        </div>
      </div>
    </div>

    <div class="note">
      <strong>Instrucciones:</strong> Dibuje su firma con el mouse o con el dedo (si su dispositivo lo permite). Cuando termine, haga clic en <em>Descargar PDF</em> para guardar el formulario con las firmas.
    </div>

    <div style="display:flex; gap:10px; margin-top:12px;">
      <button type="button" id="downloadPdf">Descargar PDF</button>
      <button type="button" id="saveJson">Guardar datos (JSON)</button>
      <button type="reset" id="resetBtn">Limpiar formulario</button>
    </div>
  </form>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    function setupSignature(id){
      const canvas = document.getElementById(id);
      const ctx = canvas.getContext('2d');
      function resize(){
        const ratio = window.devicePixelRatio || 1;
        canvas.width = canvas.clientWidth * ratio;
        canvas.height = canvas.clientHeight * ratio;
        ctx.scale(ratio, ratio);
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
      }
      resize();
      window.addEventListener('resize', resize);
      let drawing = false;
      function start(e){
        drawing = true;
        ctx.beginPath();
        const pos = getPos(e, canvas);
        ctx.moveTo(pos.x, pos.y);
      }
      function move(e){
        if(!drawing) return;
        const pos = getPos(e, canvas);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
      }
      function end(){
        drawing = false;
      }
      canvas.addEventListener('mousedown', start);
      canvas.addEventListener('touchstart', start);
      canvas.addEventListener('mousemove', move);
      canvas.addEventListener('touchmove', move);
      canvas.addEventListener('mouseup', end);
      canvas.addEventListener('mouseout', end);
      canvas.addEventListener('touchend', end);
      function getPos(e, canvas){
        const rect = canvas.getBoundingClientRect();
        if(e.touches && e.touches[0]) {
          return {x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top};
        } else {
          return {x: e.clientX - rect.left, y: e.clientY - rect.top};
        }
      }
    }
    setupSignature('sig1');
    setupSignature('sig2');
    function clearSig(id){
      const c = document.getElementById(id);
      const ctx = c.getContext('2d');
      ctx.clearRect(0,0,c.width,c.height);
    }
    document.getElementById('downloadPdf').addEventListener('click', async function(){
      const sig1 = document.getElementById('sig1');
      const sig2 = document.getElementById('sig2');
      const data1 = sig1.toDataURL('image/png');
      const data2 = sig2.toDataURL('image/png');
      const wrapper = document.createElement('div');
      wrapper.style.padding = '20px';
      wrapper.style.fontFamily = 'Arial, sans-serif';
      const html = `
        <h2>Solicitud de Vacaciones</h2>
        <p><strong>Nombre:</strong> ${document.getElementById('nombre').value || ''}</p>
        <p><strong>Área / Puesto:</strong> ${document.getElementById('area').value || ''}</p>
        <p><strong>Fecha de ingreso:</strong> ${document.getElementById('fecha_ingreso').value || ''}</p>
        <p><strong>Periodo solicitado:</strong> ${document.getElementById('fecha_inicio').value || ''} al ${document.getElementById('fecha_fin').value || ''}</p>
        <p><strong>Total días:</strong> ${document.getElementById('total_dias').value || ''}</p>
        <p><strong>Comentarios:</strong> ${document.getElementById('comentarios').value || ''}</p>
        <div style="display:flex; gap:30px; margin-top:20px;">
          <div style="flex:1; text-align:center;">
            <p>Firma del colaborador(a):</p>
            <img src="${data1}" style="border:1px solid #999; max-width:100%; height:120px; object-fit:contain;"/>
          </div>
          <div style="flex:1; text-align:center;">
            <p>Firma Responsable / RRHH:</p>
            <img src="${data2}" style="border:1px solid #999; max-width:100%; height:120px; object-fit:contain;"/>
          </div>
        </div>
      `;
      wrapper.innerHTML = html;
      document.body.appendChild(wrapper);
      const canvas = await html2canvas(wrapper, {scale:2});
      const imgData = canvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ unit: 'pt', format: 'a4' });
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
      pdf.addImage(imgData, 'PNG', 20, 20, pdfWidth-40, pdfHeight);
      pdf.save('Solicitud_Vacaciones.pdf');
      document.body.removeChild(wrapper);
    });
    document.getElementById('saveJson').addEventListener('click', function(){
      const sig1 = document.getElementById('sig1').toDataURL('image/png');
      const sig2 = document.getElementById('sig2').toDataURL('image/png');
      const data = {
        nombre: document.getElementById('nombre').value,
        area: document.getElementById('area').value,
        fecha_ingreso: document.getElementById('fecha_ingreso').value,
        fecha_inicio: document.getElementById('fecha_inicio').value,
        fecha_fin: document.getElementById('fecha_fin').value,
        total_dias: document.getElementById('total_dias').value,
        comentarios: document.getElementById('comentarios').value,
        firma_colaborador: sig1,
        firma_rrhh: sig2,
        generado_en: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Solicitud_Vacaciones.json';
      a.click();
      URL.revokeObjectURL(url);
    });
    document.getElementById('resetBtn').addEventListener('click', function(){
      setTimeout(function(){ clearSig('sig1'); clearSig('sig2'); }, 20);
    });
  </script>
</body>
</html>
